<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TVMaze API Demo</title>
    <style>
        th {
            border-style: none;
            background-color: #cccccc;
        }

        td {
            border-style: none;
            text-align: center;
        }

        .on {
            background-color: #c7e1e5;
        }

    </style>

    <script>
        function execute_search(api, button) {
            if (button == 'All Shows') {
                const page_num = Number(document.getElementById("page_input").value)
                api = api + page_num
                if (document.getElementById("followed_shows").checked) {
                    api = api + "/followed"
                }
            }
            fetch(api, {
                mode: 'cors',
                headers: {
                    'Access-Control-Allow-Origin': 'http://127.0.0.1'
                }
            })
                .then(response => response.json())
                .then(result => process_json(result))
        }

        function process_json(data) {
            const theList = document.getElementById("output_list")
            if (data.length) {
                const table_start = `<table id='theListings'>
                                        <tr>
                                            <th> ShowID </th>
                                            <th> Name </th>
                                            <th> TVM url </th>
                                            <th> Premiered </th>
                                            <th> Status </th>
                                            <th> Language </th>
                                            <th> Network </th>
                                            <th> Country </th>
                                            <th> Type </th>
                                            <th> Followed </th>
                                            <th> No. Episodes </th>
                                        </tr>`
                let output = ''
                console.log("Number of Records: ", data.length)
                idx = 2
                for (const row of data) {
                    if (idx % 2) {
                        td_class = 'class="on"'
                    } else {
                        td_class = 'class="off"'
                    }
                    if (row.eps_count == 'None' || row.eps_count == "0") {
                        row.eps_count = ''
                    }
                    if (row.status == 'Followed') {
                        row.status = "Yes"
                    } else {
                        row.status = ""
                    }
                    if (row.premiered == 'None' || row.premiered == '2030-12-31') {
                        row.premiered = ""
                    }

                    output += `<tr>
                                 <td ${td_class}>${row.showid}</td>
                                 <td ${td_class}>${row.showname}</td>
                                 <td ${td_class}><a href="${row.url}" target="_blank"><img src="../resources/tvmaze.jpeg" width="24", height="24"> </a></td>
                                 <td ${td_class}>${row.premiered}</td>
                                 <td ${td_class}>${row.showstatus}</td>
                                 <td ${td_class}>${row.language}</td>
                                 <td ${td_class}>${row.network}</td>
                                 <td ${td_class}>${row.country}</td>
                                 <td ${td_class}>${row.type}</td>
                                 <td ${td_class}>${row.status}</td>
                                 <td ${td_class}>${row.eps_count}</td>
                               </tr>`
                    idx++
                }
                const table_end = '</table>'
                theList.innerHTML = table_start + output + table_end
            } else {
                theList.innerHTML = ''
            }
        }


    </script>

</head>

<body>
<h1>Simple Demo Accessing APIs</h1>

<h2>Using the APIs from my TVMaze Management System</h2>

<p><em>Technologies used: <br> APIs (Python3, MariaDB and Flask)<br> Browser (HTML, CSS and JavaScript)</em></p>

<details>
    <summary>All Shows API</summary>
    <p>
        <strong>'/apis/v1/shows/page/page-number'</strong> <br>
        input:  'page-number' as integer.   There are currently ~51 pages of shows in the system
        <br>
        output: A table with show info.  Each page can contains up to 1000 shows.
        <br>
    </p>
    <label for="page_input">Page Number: </label>
    <input id="page_input" type="text"/>
    <button id="search_button_1" onclick="execute_search('http://127.0.0.1:5000/apis/v1/shows/page/', 'All Shows')">
        Search
    </button>
</details>
<br>
<details>
    <summary>All Followed Shows API</summary>
    <p>
        <strong>'/apis/v1/shows/followed'</strong> returning: Shows Info of all shows with the Followed status

        <button id="search_button_2" onclick="execute_search('http://127.0.0.1:5000/apis/v1/shows/followed')">Search
        </button>
    </p>
</details>
<br>
<details>
    <summary>Find show via it's TVMaze ID API</summary>
    <p>
        <strong>'/apis/v1/show/id'</strong> returning: Show Info (id = integer)
        <button id="search_button_3" onclick="execute_search('http://127.0.0.1:5000/apis/v1/show/13')">Search</button>
    </p>
</details>
<br>
<details>
    <summary>Find show via it's Show Name API</summary>
    <p>
        <strong>'/apis/v1/show/name/showname'</strong> returning: Show Info (showname = string)
        <button id="search_button_4" onclick="execute_search('http://127.0.0.1:5000/apis/v1/show/name/Lost')">Search
        </button>
    </p>
</details>

<p>
    Not Implemented Yet
    <label for="rating"></label>
    <select id="rating">
        <option disabled selected value="0">Select one</option>
        <option value="1">Show all restaurants</option>
        <option value="2">Show 2-star or better</option>
        <option value="3">Show 3-star or better</option>
        <option value="4">Show 4-star or better</option>
        <option value="5">Show only 5-star</option>
    </select>
</p>

<p>
    Filtering<br/>
    <input id="followed_shows" type="checkbox">
    <label for="followed_shows"> Followed Shows </label>
    <br>
    <input id="in_dev" type="checkbox">
    <label for="in_dev"> In Development </label>
    <br>
    <input id="wild_card" type="checkbox">
    <label for="wild_card"> Wild Card Name Search</label>
    <br>
</p>

<p>
    <label for="search_text_field">Look for: </label>
    <input id="search_text_field" type="text"/>
    <button id="search_button" onclick="listRestaurants()">Search</button>
</p>
<div id="output_list">
</div>
</body>

</html>
